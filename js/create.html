<!DOCTYPE html>
<html lang="uz" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TestPro ‚Äî Test Yaratish</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/style.css" />
  <style>
    .topbar { display:none;position:fixed;top:0;left:0;right:0;height:64px;background:var(--navbar-bg);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);align-items:center;justify-content:space-between;padding:0 1.25rem;z-index:200; }
    @media(max-width:1024px){.topbar{display:flex;}}
    .topbar-logo{font-family:'Syne',sans-serif;font-size:1.3rem;font-weight:800;background:var(--grad-1);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
    .sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);backdrop-filter:blur(4px);z-index:99;}
    .sidebar-overlay.show{display:block;}

    .question-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
      margin-bottom: 1rem;
      transition: all var(--transition);
      backdrop-filter: blur(12px);
      position: relative;
    }

    .question-card:hover {
      border-color: var(--accent);
      box-shadow: 0 8px 24px var(--shadow);
    }

    .question-card.dragging {
      opacity: 0.5;
      border: 2px dashed var(--accent);
    }

    .q-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.25rem;
    }

    .q-number {
      width: 32px; height: 32px;
      background: var(--grad-1);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Syne', sans-serif;
      font-weight: 800;
      font-size: 0.85rem;
      flex-shrink: 0;
    }

    .q-type-badge {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .q-delete-btn {
      margin-left: auto;
    }

    .option-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .option-correct {
      width: 18px; height: 18px;
      border-radius: 50%;
      border: 2px solid var(--border);
      cursor: pointer;
      flex-shrink: 0;
      transition: all var(--transition);
      background: none;
      appearance: none;
      -webkit-appearance: none;
    }

    .option-correct:checked {
      background: var(--accent);
      border-color: var(--accent);
    }

    .option-correct-sq {
      width: 18px; height: 18px;
      border-radius: 4px;
      border: 2px solid var(--border);
      cursor: pointer;
      flex-shrink: 0;
      transition: all var(--transition);
      background: none;
      appearance: none;
      -webkit-appearance: none;
    }

    .option-correct-sq:checked {
      background: var(--accent);
      border-color: var(--accent);
    }

    .add-option-btn {
      font-size: 0.82rem;
      color: var(--accent);
      background: none;
      border: 1px dashed var(--border);
      border-radius: var(--radius-sm);
      padding: 0.4rem 0.75rem;
      cursor: pointer;
      transition: all var(--transition);
      font-family: 'DM Sans', sans-serif;
    }

    .add-option-btn:hover {
      background: rgba(108,99,255,0.08);
      border-color: var(--accent);
    }

    .add-question-area {
      border: 2px dashed var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all var(--transition);
      margin-top: 1.5rem;
    }

    .add-question-area:hover {
      border-color: var(--accent);
      background: rgba(108,99,255,0.04);
    }

    .q-type-selector {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }

    .q-type-btn {
      font-size: 0.8rem;
      padding: 0.35rem 0.85rem;
      border-radius: 99px;
      border: 1px solid var(--border);
      background: var(--surface-2);
      cursor: pointer;
      transition: all var(--transition);
      font-family: 'DM Sans', sans-serif;
      color: var(--text-2);
    }

    .q-type-btn.active,
    .q-type-btn:hover {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    .settings-card {
      position: sticky;
      top: 2rem;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .create-layout {
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 1.5rem;
      align-items: start;
    }

    @media (max-width: 1024px) {
      .create-layout { grid-template-columns: 1fr; }
      .settings-card { position: static; }
    }
  </style>
</head>
<body>

  <div class="topbar">
    <div class="topbar-logo">TestPro</div>
    <div style="display:flex;gap:0.75rem;align-items:center">
      <button class="theme-toggle">üåô</button>
      <button class="hamburger sidebar-toggle"><span></span><span></span><span></span></button>
    </div>
  </div>

  <div class="sidebar-overlay"></div>

  <aside class="sidebar">
    <div class="sidebar-logo">TestPro</div>
    <nav class="sidebar-nav">
      <div class="sidebar-section-title">Asosiy</div>
      <a href="dashboard.html" class="sidebar-nav-item"><span class="nav-icon">üìä</span> Dashboard</a>
      <a href="create.html" class="sidebar-nav-item active"><span class="nav-icon">‚úèÔ∏è</span> Test yaratish</a>
    </nav>
    <div class="sidebar-footer">
      <div class="user-info">
        <div class="user-avatar" id="user-avatar">?</div>
        <div>
          <div class="user-name" id="user-name">...</div>
          <div class="user-role" id="user-role">foydalanuvchi</div>
        </div>
        <button id="logout-btn" class="btn btn-ghost btn-sm" style="margin-left:auto">üö™</button>
      </div>
    </div>
  </aside>

  <main class="main-content">
    <div class="page-header" style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem">
      <div>
        <h1 id="page-title">Yangi test yaratish</h1>
        <p>Savollar qo'shing, sozlang va saqlang.</p>
      </div>
      <div style="display:flex;gap:0.75rem">
        <a href="dashboard.html" class="btn btn-ghost btn-sm">‚Üê Orqaga</a>
        <button class="btn btn-primary" id="save-btn">üíæ Saqlash</button>
      </div>
    </div>

    <div id="save-alert"></div>

    <div class="create-layout">

      <!-- Left: Questions -->
      <div>
        <div class="glass-card" style="margin-bottom:1.5rem">
          <h2 style="font-size:1rem;margin-bottom:1.25rem">üìã Test ma'lumotlari</h2>
          <div class="form-group">
            <label class="form-label">Test nomi *</label>
            <input type="text" id="test-title" class="form-input" placeholder="Masalan: HTML & CSS asoslar" required />
          </div>
          <div class="form-group">
            <label class="form-label">Tavsif (ixtiyoriy)</label>
            <textarea id="test-desc" class="form-input" placeholder="Test haqida qisqacha ma'lumot..." rows="2"></textarea>
          </div>
        </div>

        <!-- Questions list -->
        <div id="questions-container"></div>

        <!-- Add question area -->
        <div class="add-question-area" id="add-question-area">
          <div style="font-size:1.5rem;margin-bottom:0.5rem">‚ûï</div>
          <p style="font-size:0.9rem;color:var(--text-2);margin-bottom:0.5rem">Savol qo'shish</p>
          <div class="q-type-selector" style="justify-content:center">
            <button class="q-type-btn" onclick="addQuestion('multiple')">‚≠ï Ko'p tanlov</button>
            <button class="q-type-btn" onclick="addQuestion('truefalse')">‚úÖ Ha/Yo'q</button>
            <button class="q-type-btn" onclick="addQuestion('text')">üìù Matn</button>
          </div>
        </div>
      </div>

      <!-- Right: Settings -->
      <div class="settings-card">
        <div class="glass-card">
          <h2 style="font-size:1rem;margin-bottom:1.25rem">‚öôÔ∏è Test sozlamalari</h2>

          <div class="form-group">
            <label class="form-label">Ko'rinish</label>
            <select id="test-visibility" class="form-input">
              <option value="public">üåê Ommaviy</option>
              <option value="private">üîí Shaxsiy</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Vaqt limiti (daqiqa, 0 = cheksiz)</label>
            <input type="number" id="test-time" class="form-input" value="0" min="0" max="180" />
          </div>

          <div class="form-group">
            <label class="form-label">O'tish bali (%)</label>
            <input type="number" id="test-pass" class="form-input" value="60" min="0" max="100" />
          </div>

          <div class="form-group">
            <label class="form-label">Savollar soni cheklovisi</label>
            <input type="number" id="test-q-limit" class="form-input" value="0" min="0"
              placeholder="0 = hammasi ko'rsatiladi" />
          </div>

          <div class="divider"></div>

          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:0.75rem">
            <label class="form-label" style="margin:0">Savollar tartibini aralashtirish</label>
            <label class="toggle-switch">
              <input type="checkbox" id="test-shuffle">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div style="display:flex;align-items:center;justify-content:space-between">
            <label class="form-label" style="margin:0">Natijani ko'rsatish</label>
            <label class="toggle-switch">
              <input type="checkbox" id="test-show-result" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="divider"></div>

          <div style="background:var(--surface-2);border:1px solid var(--border);border-radius:var(--radius-sm);padding:1rem;font-size:0.82rem;color:var(--text-2)">
            <strong id="q-count">0</strong> ta savol qo'shildi
          </div>

        </div>
      </div>

    </div>
  </main>

  <style>
    /* Toggle switch */
    .toggle-switch { position:relative; display:inline-block; width:40px; height:22px; }
    .toggle-switch input { opacity:0; width:0; height:0; }
    .toggle-slider { position:absolute; cursor:pointer; inset:0; background:var(--border); border-radius:99px; transition:all 0.3s; }
    .toggle-slider::before { content:''; position:absolute; width:16px; height:16px; left:3px; top:3px; background:white; border-radius:50%; transition:all 0.3s; }
    .toggle-switch input:checked + .toggle-slider { background:var(--accent); }
    .toggle-switch input:checked + .toggle-slider::before { transform:translateX(18px); }
  </style>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="js/firebase.js"></script>
  <script src="js/theme.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/create.js"></script>

</body>
</html>
