<!DOCTYPE html>
<html lang="uz" data-theme="light">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>TestPro ‚Äî Tarix</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Unbounded:wght@700;800;900&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Plus Jakarta Sans',sans-serif;min-height:100vh;
  background:linear-gradient(135deg,#f5f3ff 0%,#fce7f3 50%,#eff6ff 100%);color:#1a1a2e}
[data-theme="dark"] body{background:linear-gradient(135deg,#0d0820,#140a20,#080d1a);color:#e8e0ff}
.nav{position:fixed;top:0;left:0;right:0;height:54px;z-index:500;
  display:flex;align-items:center;justify-content:space-between;padding:0 1rem;
  background:rgba(245,243,255,.92);backdrop-filter:blur(20px);
  border-bottom:1px solid rgba(124,58,237,.1)}
[data-theme="dark"] .nav{background:rgba(13,8,32,.92)}
.logo{font-family:'Unbounded',sans-serif;font-size:1.1rem;font-weight:900;cursor:pointer;
  background:linear-gradient(135deg,#7c3aed,#ec4899);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.nav-r{display:flex;gap:.4rem;align-items:center}
.nbtn{padding:.38rem .8rem;border-radius:8px;border:1.5px solid rgba(0,0,0,.1);
  background:#fff;cursor:pointer;font-size:.78rem;font-weight:700;
  font-family:'Plus Jakarta Sans',sans-serif;color:#374151;transition:all .2s}
[data-theme="dark"] .nbtn{background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.12);color:#c4b5fd}
.nbtn:hover{border-color:#7c3aed;color:#7c3aed}
.tbtn{width:31px;height:31px;border-radius:8px;border:1.5px solid rgba(0,0,0,.1);
  background:#fff;cursor:pointer;font-size:.82rem}
[data-theme="dark"] .tbtn{background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.15)}
.page{padding:70px 1rem 3rem;max-width:600px;margin:0 auto}
.page-h{font-family:'Unbounded',sans-serif;font-size:1.25rem;font-weight:900;margin-bottom:1.25rem}
.hi{display:flex;align-items:center;justify-content:space-between;gap:.75rem;
  padding:.9rem 1rem;background:#fff;border:1px solid rgba(0,0,0,.07);
  border-radius:14px;margin-bottom:.55rem;transition:all .2s;flex-wrap:wrap}
[data-theme="dark"] .hi{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.09)}
.hi:hover{border-color:rgba(124,58,237,.3);box-shadow:0 3px 12px rgba(124,58,237,.1)}
.hi-title{font-size:.88rem;font-weight:700;color:#111827;margin-bottom:.15rem}
[data-theme="dark"] .hi-title{color:#e5e7eb}
.hi-meta{font-size:.7rem;color:#9ca3af}
.score-pill{font-family:'Unbounded',sans-serif;font-size:.85rem;font-weight:900;
  padding:.28rem .8rem;border-radius:99px;flex-shrink:0}
.sp-g{background:rgba(5,150,105,.1);color:#059669;border:1px solid rgba(5,150,105,.2)}
.sp-a{background:rgba(245,158,11,.1);color:#d97706;border:1px solid rgba(245,158,11,.2)}
.sp-r{background:rgba(239,68,68,.1);color:#ef4444;border:1px solid rgba(239,68,68,.2)}
.sp-el{width:26px;height:26px;border:2.5px solid rgba(124,58,237,.2);
  border-top-color:#7c3aed;border-radius:50%;animation:spin .7s linear infinite;margin:2rem auto}
@keyframes spin{to{transform:rotate(360deg)}}
.emp{text-align:center;padding:2rem;color:#9ca3af;font-size:.82rem}
</style>
</head>
<body>
<nav class="nav">
  <div class="logo" onclick="goTo('index.html')">TestPro</div>
  <div class="nav-r">
    <button class="nbtn" onclick="goTo('dashboard.html')">‚Üê Dashboard</button>
    <button class="tbtn" id="tbtn">üåô</button>
  </div>
</nav>
<div class="page">
  <div class="page-h">üìú Test tarixi</div>
  <div id="list"><div class="sp-el"></div></div>
</div>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="js/firebase.js"></script>
<script>
const T={get(){return localStorage.getItem('tp_theme')||(matchMedia('(prefers-color-scheme:dark)').matches?'dark':'light')},
  set(t){document.documentElement.setAttribute('data-theme',t);localStorage.setItem('tp_theme',t);
    document.getElementById('tbtn').textContent=t==='dark'?'‚òÄÔ∏è':'üåô'},
  toggle(){this.set(this.get()==='dark'?'light':'dark')}};
T.set(T.get());
document.getElementById('tbtn').onclick=()=>T.toggle();

(async()=>{
  const user=await AuthHelpers.requireAuth('login.html');
  if(!user)return;
  const wrap=document.getElementById('list');
  try{
    const results=await DB.getMyResults(user.uid,50);
    if(!results.length){wrap.innerHTML='<div class="emp">Hali test ishlanmagan</div>';return;}
    wrap.innerHTML=results.map(r=>{
      const cls=r.score>=80?'sp-g':r.score>=50?'sp-a':'sp-r';
      return `<div class="hi">
        <div>
          <div class="hi-title">${esc(r.testTitle||'Test')}</div>
          <div class="hi-meta">${fmtDate(r.completedAt)} ¬∑ ${r.correct||0} to'g'ri ¬∑ ${fmtTime(r.elapsed||0)}</div>
        </div>
        <div class="score-pill ${cls}">${r.score||0}%</div>
      </div>`;
    }).join('');
  }catch(e){wrap.innerHTML=`<div class="emp" style="color:#ef4444">‚ùå ${e.message}</div>`;}
})();
</script>
</body>
</html>
