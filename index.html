<!DOCTYPE html>
<html lang="uz" data-theme="light">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>TestPro</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Unbounded:wght@700;800;900&display=swap" rel="stylesheet"/>
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html{scroll-behavior:smooth}
:root{--bg:#EEF0FF;--card:#fff;--text:#1a1a2e;--text2:#6b7280;--text3:#9ca3af;
  --acc:#6C3FE8;--acc2:#C040C8;--border:rgba(108,63,232,.1);
  --shadow:0 2px 12px rgba(108,63,232,.08)}
[data-theme=dark]{--bg:#0d0820;--card:#140d28;--text:#e8e0ff;--text2:#9ca3af;--text3:#6b7280;
  --border:rgba(108,63,232,.2);--shadow:0 2px 12px rgba(0,0,0,.3)}
body{font-family:'Plus Jakarta Sans',sans-serif;min-height:100vh;background:var(--bg);color:var(--text);overflow-x:hidden}

/* NAV */
.nav{position:fixed;top:0;left:0;right:0;height:54px;z-index:500;
  display:flex;align-items:center;justify-content:space-between;padding:0 1rem;
  background:var(--bg);backdrop-filter:blur(20px);}
.logo{font-family:'Unbounded',sans-serif;font-size:1.15rem;font-weight:900;cursor:pointer;
  background:linear-gradient(135deg,var(--acc),var(--acc2));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.nav-mid{display:flex;align-items:center;gap:.2rem}
.ntab{padding:.4rem .82rem;border-radius:99px;font-size:.8rem;font-weight:700;
  cursor:pointer;border:none;font-family:inherit;background:transparent;
  color:var(--text2);transition:all .2s}
.ntab.on{background:rgba(255,255,255,.9);color:var(--acc);
  box-shadow:0 2px 8px rgba(0,0,0,.08)}
[data-theme=dark] .ntab.on{background:rgba(255,255,255,.1)}
.nav-r{display:flex;align-items:center;gap:.4rem}
.ibtn{width:34px;height:34px;border-radius:99px;border:none;cursor:pointer;font-size:.9rem;
  background:rgba(255,255,255,.8);display:flex;align-items:center;justify-content:center;transition:all .2s}
[data-theme=dark] .ibtn{background:rgba(255,255,255,.1)}
.lbtn{padding:.4rem .88rem;border-radius:99px;font-size:.78rem;font-weight:700;
  border:none;cursor:pointer;font-family:inherit;
  background:linear-gradient(135deg,var(--acc),var(--acc2));color:#fff;transition:all .2s}
.lbtn:hover{transform:translateY(-1px);box-shadow:0 4px 14px rgba(108,63,232,.35)}

/* PAGE */
.page{padding:66px 0 3rem}

/* SUBJECT GROUP */
.grp{margin-bottom:1.8rem}
.grp-hdr{display:flex;align-items:center;justify-content:space-between;padding:0 1rem;margin-bottom:.75rem}
.grp-l{display:flex;align-items:center;gap:.65rem}
.grp-icon{width:46px;height:46px;border-radius:14px;
  background:rgba(255,255,255,.9);
  box-shadow:0 2px 10px rgba(0,0,0,.07);
  display:flex;align-items:center;justify-content:center;font-size:1.55rem;flex-shrink:0}
[data-theme=dark] .grp-icon{background:rgba(255,255,255,.1)}
.grp-nm{font-size:.94rem;font-weight:800;color:var(--text)}
.grp-ct{font-size:.72rem;color:var(--text3);font-weight:600;margin-top:.05rem}
.see-all{font-size:.78rem;font-weight:700;color:var(--acc);cursor:pointer;border:none;
  background:none;font-family:inherit;white-space:nowrap}

/* SCROLL */
.scroll{display:flex;gap:.75rem;overflow-x:auto;padding:0 1rem .5rem;
  scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch}
.scroll::-webkit-scrollbar{display:none}

/* CARD */
.card{min-width:175px;max-width:175px;flex-shrink:0;scroll-snap-align:start;
  background:var(--card);border-radius:18px;padding:.9rem;
  border:1.5px solid var(--border);box-shadow:var(--shadow);
  cursor:pointer;transition:transform .2s,box-shadow .2s;display:flex;flex-direction:column}
.card:hover{transform:translateY(-3px);box-shadow:0 8px 24px rgba(108,63,232,.15)}
.card-icon{width:46px;height:46px;border-radius:13px;background:var(--bg);
  display:flex;align-items:center;justify-content:center;font-size:1.45rem;margin-bottom:.6rem}
.card-title{font-size:.85rem;font-weight:800;color:var(--text);margin-bottom:.15rem;
  overflow:hidden;text-overflow:ellipsis;display:-webkit-box;
  -webkit-line-clamp:2;-webkit-box-orient:vertical;line-height:1.35}
.card-author{font-size:.68rem;color:var(--text3);margin-bottom:.45rem;
  overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.chips{display:flex;gap:.28rem;flex-wrap:wrap;margin-bottom:.6rem}
.ch{display:inline-flex;align-items:center;padding:.15rem .42rem;border-radius:99px;
  font-size:.64rem;font-weight:600;background:rgba(108,63,232,.07);color:var(--acc);
  border:1px solid rgba(108,63,232,.12)}
[data-theme=dark] .ch{background:rgba(108,63,232,.2)}
.card-btn{display:block;width:100%;padding:.6rem;border-radius:11px;border:none;
  cursor:pointer;background:linear-gradient(135deg,var(--acc),var(--acc2));color:#fff;
  font-family:inherit;font-size:.8rem;font-weight:700;text-align:center;
  transition:all .2s;margin-top:auto}
.card-btn:hover{box-shadow:0 4px 14px rgba(108,63,232,.35)}

/* HERO (empty) */
.hero{text-align:center;padding:3.5rem 1.5rem}
.hero-h{font-family:'Unbounded',sans-serif;font-size:clamp(1.6rem,5vw,2.5rem);
  font-weight:900;line-height:1.1;margin-bottom:.85rem}
.hero-h span{background:linear-gradient(135deg,var(--acc),var(--acc2));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero-p{font-size:.88rem;color:var(--text2);max-width:380px;margin:0 auto 1.5rem;line-height:1.6}
.hero-btn{padding:.78rem 2rem;border-radius:13px;border:none;cursor:pointer;
  background:linear-gradient(135deg,var(--acc),var(--acc2));color:#fff;
  font-family:inherit;font-size:.9rem;font-weight:700;transition:all .22s}
.hero-btn:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(108,63,232,.35)}

/* CTA */
.cta{margin:1rem 1rem 0;background:linear-gradient(135deg,var(--acc),var(--acc2));
  border-radius:20px;padding:1.5rem;text-align:center}
.cta-h{font-family:'Unbounded',sans-serif;font-size:1.05rem;font-weight:900;color:#fff;margin-bottom:.5rem}
.cta-p{font-size:.78rem;color:rgba(255,255,255,.82);margin-bottom:1rem}
.cta-btn{padding:.65rem 1.6rem;border-radius:11px;border:none;cursor:pointer;
  background:#fff;color:var(--acc);font-weight:800;font-size:.84rem;font-family:inherit;transition:all .2s}
.cta-btn:hover{transform:translateY(-1px);box-shadow:0 5px 16px rgba(0,0,0,.2)}

/* LOADER */
.sp{width:28px;height:28px;border:3px solid rgba(108,63,232,.15);border-top-color:var(--acc);
  border-radius:50%;animation:spin .7s linear infinite;margin:2.5rem auto}
@keyframes spin{to{transform:rotate(360deg)}}
.emp{text-align:center;padding:2rem 1rem;color:var(--text3);font-size:.82rem}
.err{text-align:center;padding:1.5rem;color:#ef4444;font-size:.82rem}
</style>
</head>
<body>

<nav class="nav">
  <div class="logo" onclick="goTo('index.html')">TestPro</div>
  <div class="nav-mid">
    <button class="ntab on">Testlar</button>
    <button class="ntab" onclick="goTo('dashboard.html')">Dashboard</button>
  </div>
  <div class="nav-r">
    <button class="ibtn" id="tbtn">üåô</button>
    <button class="lbtn" id="auth-btn" onclick="goTo('login.html')">Kirish</button>
  </div>
</nav>

<div class="page">
  <div id="content"><div class="sp"></div></div>
  <div class="cta" id="cta" style="display:none">
    <div class="cta-h">O'z testingizni yarating!</div>
    <p class="cta-p">Bir necha daqiqada professional test yarating va do'stlaringiz bilan ulashing</p>
    <button class="cta-btn" onclick="goTo('login.html')">Boshlash ‚Üí</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="js/firebase.js"></script>
<script>
/* Theme */
const TH={
  get(){return localStorage.getItem('tp_theme')||(matchMedia('(prefers-color-scheme:dark)').matches?'dark':'light')},
  set(t){document.documentElement.setAttribute('data-theme',t);localStorage.setItem('tp_theme',t);
    const b=document.getElementById('tbtn');if(b)b.textContent=t==='dark'?'‚òÄÔ∏è':'üåô'},
  toggle(){this.set(this.get()==='dark'?'light':'dark')}
};
TH.set(TH.get());
document.getElementById('tbtn').onclick=()=>TH.toggle();

/* Check auth */
AuthHelpers.getCurrentUser().then(u=>{
  if(u){const b=document.getElementById('auth-btn');b.textContent='Dashboard';b.onclick=()=>goTo('dashboard.html');}
}).catch(()=>{});

/* Icons */
const ICON={english:'üá¨üáß',arabic:'üïå',russian:'üá∑üá∫',turkish:'üáπüá∑',math:'üßÆ',it:'üíª',science:'üî¨',religion:'üìñ',other:'üìö'};

/* Load */
(async()=>{
  const wrap=document.getElementById('content');
  try{
    const tests=await DB.getPublicTests();
    const pub=tests.filter(t=>t.visibility==='public');

    if(!pub.length){
      wrap.innerHTML=`<div class="hero">
        <div class="hero-h">TestPro ga<br/><span>xush kelibsiz!</span></div>
        <p class="hero-p">Hozircha ommaviy test mavjud emas. Birinchi bo'ling!</p>
        <button class="hero-btn" onclick="goTo('login.html')">Test yaratish ‚Üí</button>
      </div>`;
      return;
    }

    /* Group by subject */
    const grps={};
    pub.forEach(t=>{const k=t.subject||'other';if(!grps[k])grps[k]=[];grps[k].push(t);});

    wrap.innerHTML='';
    Object.entries(grps).forEach(([subj,arr])=>{
      const sub=getSubject(subj);
      const icon=ICON[subj]||'üìö';

      const g=document.createElement('div');
      g.className='grp';
      g.innerHTML=`
        <div class="grp-hdr">
          <div class="grp-l">
            <div class="grp-icon">${icon}</div>
            <div>
              <div class="grp-nm">${esc(sub.label)}</div>
              <div class="grp-ct">${arr.length} ta test</div>
            </div>
          </div>
          <button class="see-all">Barchasini ko'rish ‚Üí</button>
        </div>
        <div class="scroll" id="sc-${subj}"></div>`;

      const scroll=g.querySelector(`#sc-${subj}`);
      arr.forEach(t=>{
        const c=document.createElement('div');
        c.className='card';
        c.onclick=()=>goTo('test.html?id='+t.id);
        c.innerHTML=`
          <div class="card-icon">${icon}</div>
          <div class="card-title">${esc(t.title)}</div>
          <div class="card-author">${esc(t.authorName||'Anonim')}</div>
          <div class="chips">
            <span class="ch">üìù ${t.questionCount||0}</span>
            <span class="ch">üëÅ ${t.attempts||0}</span>
            ${t.timeLimit?`<span class="ch">‚è± ${t.timeLimit}daq</span>`:''}
            ${t.averageScore?`<span class="ch">‚≠ê${t.averageScore}%</span>`:''}
          </div>
          <button class="card-btn">Boshlash ‚Üí</button>`;
        scroll.appendChild(c);
      });
      wrap.appendChild(g);
    });

    document.getElementById('cta').style.display='block';

  }catch(e){
    console.error('Index load error:',e);
    wrap.innerHTML=`<div class="err">
      ‚ùå Xatolik: ${e.message}<br>
      <small style="color:#9ca3af">Firebase Console ‚Üí Firestore ‚Üí Rules da <b>allow read: if true</b> qo'ying</small>
    </div>`;
  }
})();
</script>
</body>
</html>
