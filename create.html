<!DOCTYPE html>
<html lang="uz" data-theme="light">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>TestPro ‚Äî Test Yaratish</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Unbounded:wght@700;800;900&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="css/style.css"/>
<style>
/* ‚îÄ‚îÄ Create page extras ‚îÄ‚îÄ */
.create-wrap{max-width:680px;margin:0 auto;padding:1.25rem 1rem 3rem}
.page-hdr{display:flex;align-items:center;justify-content:space-between;
  flex-wrap:wrap;gap:.75rem;margin-bottom:1.25rem}
.page-hdr h1{font-size:1.1rem;font-family:'Unbounded',sans-serif;font-weight:900;margin:0}
.hdr-btns{display:flex;gap:.55rem;align-items:center;flex-wrap:wrap}

/* SECTION CARD */
.sec{background:var(--bg-card);border:1px solid var(--border-2);
  border-radius:var(--radius-lg);padding:1.1rem 1.1rem 1.25rem;margin-bottom:1rem}
.sec-title{font-size:.88rem;font-family:'Unbounded',sans-serif;font-weight:800;
  margin-bottom:1rem;display:flex;align-items:center;gap:.4rem}

/* SUBJECT GRID */
.subj-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:.45rem;margin-bottom:.65rem}
.subj-btn{padding:.55rem .45rem;border-radius:10px;border:2px solid var(--border-2);
  background:var(--bg-2);cursor:pointer;transition:all .18s;
  text-align:center;font-size:.75rem;font-weight:600;
  font-family:'Plus Jakarta Sans',sans-serif;color:var(--text-2)}
.subj-btn:hover{border-color:var(--accent);color:var(--accent)}
.subj-btn.active{border-color:var(--accent) !important;
  background:rgba(79,70,229,.1) !important;color:var(--accent) !important;
  box-shadow:0 0 0 3px rgba(79,70,229,.12)}
.subj-btn .sb-emoji{display:block;font-size:1.2rem;margin-bottom:.18rem}

/* VISIBILITY */
.vis-grid{display:grid;grid-template-columns:1fr 1fr;gap:.5rem;margin-bottom:.65rem}
.vis-btn{padding:.72rem .5rem;border-radius:12px;
  border:2px solid var(--border-2);background:var(--bg-2);
  cursor:pointer;transition:all .18s;text-align:center;
  font-size:.78rem;font-weight:700;color:var(--text-2);
  font-family:'Plus Jakarta Sans',sans-serif;opacity:.7}
.vis-btn .vis-icon{display:block;font-size:1.3rem;margin-bottom:.22rem}
.vis-btn:hover{opacity:1;border-color:rgba(79,70,229,.4)}
.vis-btn.active{border-color:var(--accent) !important;
  background:rgba(79,70,229,.1) !important;
  color:var(--accent) !important;opacity:1;
  box-shadow:0 0 0 3px rgba(79,70,229,.12)}

/* QUESTION CARD */
.q-card{background:var(--bg-2);border:1.5px solid var(--border-2);
  border-radius:var(--radius);padding:1rem;margin-bottom:.85rem;
  position:relative;transition:border-color .2s}
.q-card:focus-within{border-color:var(--accent)}
.q-header{display:flex;align-items:center;gap:.5rem;margin-bottom:.85rem;flex-wrap:wrap}
.q-num{width:26px;height:26px;border-radius:50%;
  background:var(--accent);color:#fff;
  font-size:.72rem;font-weight:800;font-family:'Unbounded',sans-serif;
  display:flex;align-items:center;justify-content:center;flex-shrink:0}
.q-type-tabs{display:flex;gap:.35rem;flex-wrap:wrap}
.qtt{padding:.3rem .62rem;border-radius:99px;border:1.5px solid var(--border-2);
  background:var(--bg-card);font-size:.72rem;font-weight:700;
  cursor:pointer;transition:all .18s;font-family:'Plus Jakarta Sans',sans-serif;color:var(--text-2)}
.qtt:hover,.qtt.active{border-color:var(--accent);background:rgba(79,70,229,.08);color:var(--accent)}
.q-actions{display:flex;gap:.35rem;margin-left:auto}
.opt-row{display:flex;align-items:center;gap:.5rem;margin-bottom:.45rem}
.opt-radio{width:16px;height:16px;accent-color:var(--accent);flex-shrink:0;cursor:pointer}
.opt-input{flex:1}
.opt-input.correct{border-color:#059669 !important;background:rgba(5,150,105,.06) !important}
.add-opt-btn{width:100%;padding:.5rem;border-radius:9px;
  border:1.5px dashed var(--border-2);background:transparent;
  font-size:.78rem;color:var(--text-3);cursor:pointer;
  font-family:'Plus Jakarta Sans',sans-serif;font-weight:600;
  margin-top:.3rem;transition:all .18s}
.add-opt-btn:hover{border-color:var(--accent);color:var(--accent)}

/* ADD QUESTION AREA */
.add-area{border:2px dashed rgba(79,70,229,.28);border-radius:16px;
  padding:1.25rem 1rem;text-align:center;
  background:rgba(79,70,229,.03);margin-top:.85rem}
.add-area-label{font-size:.82rem;color:#6b7280;font-weight:600;margin-bottom:.85rem}
.add-q-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:.45rem}
.aqbtn{padding:.72rem .35rem;border-radius:12px;cursor:pointer;
  font-weight:700;font-size:.76rem;font-family:'Plus Jakarta Sans',sans-serif;
  transition:all .2s;border:2px solid;display:flex;
  flex-direction:column;align-items:center;gap:.22rem}
.aqbtn-m{border-color:rgba(79,70,229,.22);background:rgba(79,70,229,.07);color:#4f46e5}
.aqbtn-m:hover{background:rgba(79,70,229,.16)}
.aqbtn-t{border-color:rgba(5,150,105,.22);background:rgba(5,150,105,.07);color:#059669}
.aqbtn-t:hover{background:rgba(5,150,105,.16)}
.aqbtn-x{border-color:rgba(245,158,11,.22);background:rgba(245,158,11,.07);color:#d97706}
.aqbtn-x:hover{background:rgba(245,158,11,.16)}

/* IMPORT MODAL */
.imp-modal-bg{display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.5);z-index:900;
  align-items:center;justify-content:center;padding:1rem}
.imp-modal-bg.show{display:flex}
.imp-box{background:var(--bg-card);border-radius:20px;
  width:100%;max-width:440px;max-height:88vh;
  overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.25)}
[data-theme="dark"] .imp-box{background:#1a0d30}
.imp-hdr{display:flex;align-items:center;justify-content:space-between;
  padding:1.1rem 1.25rem .9rem;border-bottom:1px solid var(--border-2);position:sticky;top:0;
  background:var(--bg-card);z-index:2}
[data-theme="dark"] .imp-hdr{background:#1a0d30}
.imp-body{padding:1.1rem 1.25rem}
.imp-tabs{display:grid;grid-template-columns:1fr 1fr;gap:.5rem;margin-bottom:1rem}
.impt{padding:.65rem;border-radius:11px;border:2px solid var(--border-2);
  background:var(--bg-2);font-weight:700;font-size:.82rem;
  cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;color:var(--text-2);
  transition:all .2s;text-align:center}
.impt.on{border-color:var(--accent);background:rgba(79,70,229,.1);color:var(--accent)}
.fmt-tabs{display:flex;gap:.4rem;flex-wrap:wrap;margin-bottom:.75rem}
.fmtt{padding:.32rem .7rem;border-radius:99px;border:1.5px solid var(--border-2);
  background:var(--bg-2);font-size:.72rem;font-weight:700;
  cursor:pointer;color:var(--text-3);font-family:'Plus Jakarta Sans',sans-serif;transition:all .2s}
.fmtt.on{border-color:var(--accent);background:rgba(79,70,229,.1);color:var(--accent)}
.fmt-preview{background:var(--bg-2);border:1px solid var(--border-2);
  border-radius:10px;padding:.75rem .85rem;font-family:monospace;
  font-size:.74rem;line-height:1.7;color:var(--text-2);
  max-height:130px;overflow-y:auto;margin-bottom:.65rem;white-space:pre-wrap}
.drop-zone{border:2.5px dashed rgba(79,70,229,.32);border-radius:14px;
  padding:2rem 1.25rem;text-align:center;cursor:pointer;
  background:rgba(79,70,229,.03);transition:all .22s}
.drop-zone:hover,.drop-zone.drag{border-color:var(--accent);background:rgba(79,70,229,.08)}
.drop-label{display:inline-flex;align-items:center;gap:.45rem;
  padding:.62rem 1.35rem;border-radius:10px;
  background:linear-gradient(135deg,#4f46e5,#7c3aed);color:#fff;
  font-weight:700;font-size:.83rem;cursor:pointer;
  font-family:'Plus Jakarta Sans',sans-serif;margin-top:.6rem}

/* EXPLANATION TOGGLE */
.expl-toggle{background:none;border:none;cursor:pointer;
  font-size:.78rem;color:var(--text-3);font-weight:600;
  font-family:'Plus Jakarta Sans',sans-serif;padding:.3rem 0;
  display:flex;align-items:center;gap:.3rem;margin-top:.55rem}
.expl-toggle:hover{color:var(--accent)}
.expl-area{margin-top:.5rem;display:none}
.expl-area.open{display:block}
</style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
  <div class="topbar-brand" onclick="goTo('index.html')" style="cursor:pointer">TestPro</div>
  <div style="display:flex;gap:.55rem;align-items:center">
    <button class="theme-toggle">üåô</button>
    <button class="hamburger sidebar-toggle"><span></span><span></span><span></span></button>
  </div>
</div>
<div class="sidebar-overlay"></div>
<aside class="sidebar">
  <div style="padding:1.2rem 1rem .5rem;border-bottom:1px solid var(--border)">
    <div style="font-family:'Unbounded',sans-serif;font-size:1.15rem;font-weight:900;
      background:var(--grad-main);-webkit-background-clip:text;
      -webkit-text-fill-color:transparent;background-clip:text">TestPro</div>
  </div>
  <div class="sidebar-inner">
    <button class="sidebar-nav-item" onclick="goTo('dashboard.html')">üìä Dashboard</button>
    <button class="sidebar-nav-item active">‚úèÔ∏è Test yaratish</button>
    <button class="sidebar-nav-item" onclick="goTo('history.html')">üìú Tarix</button>
    <button class="sidebar-nav-item" onclick="goTo('profile.html')">üë§ Profil</button>
  </div>
  <div class="sidebar-footer">
    <div class="user-chip">
      <div class="user-ava" id="side-ava">?</div>
      <div style="flex:1;min-width:0"><div class="user-chip-name" id="side-name">...</div></div>
      <button id="logout-btn" class="btn btn-ghost btn-sm" style="padding:.3rem .5rem">üö™</button>
    </div>
  </div>
</aside>

<main style="padding-top:58px">
<div class="create-wrap">

  <!-- Header -->
  <div class="page-hdr">
    <div>
      <h1 id="page-title">Yangi test yaratish</h1>
      <p style="font-size:.78rem;color:var(--text-3);margin-top:.15rem">Savollar qo'shing va sozlang</p>
    </div>
    <div class="hdr-btns">
      <button class="btn btn-ghost btn-sm" onclick="goTo('dashboard.html')">‚Üê Orqaga</button>
      <button class="btn btn-secondary btn-sm" onclick="openImport()">üì• Import</button>
      <button class="btn btn-primary" id="save-btn">üíæ Saqlash</button>
    </div>
  </div>

  <div id="save-alert" style="margin-bottom:.85rem"></div>

  <!-- TEST INFO -->
  <div class="sec">
    <div class="sec-title">üìã Test haqida</div>
    <div class="form-group">
      <label class="form-label">Test nomi *</label>
      <input id="t-title" type="text" class="form-input" placeholder="Masalan: English Grammar A2"/>
    </div>
    <div class="form-group">
      <label class="form-label">Tavsif (ixtiyoriy)</label>
      <textarea id="t-desc" class="form-input" rows="2" placeholder="Test haqida qisqacha..."></textarea>
    </div>
    <div class="form-group">
      <label class="form-label">Fan / Guruh *</label>
      <div class="subj-grid" id="subj-grid"></div>
      <div style="display:flex;gap:.45rem;align-items:center;margin-top:.35rem">
        <input id="custom-subj" type="text" class="form-input" style="flex:1"
          placeholder="Boshqa (o'z nomingizni yozing)..."/>
        <button class="btn btn-secondary btn-sm" onclick="setCustomSubj()">‚úì Qo'llash</button>
      </div>
    </div>
    <div id="selected-subj-wrap" style="display:none;margin-top:-.35rem;margin-bottom:.65rem"></div>
  </div>

  <!-- SETTINGS -->
  <div class="sec">
    <div class="sec-title">‚öôÔ∏è Sozlamalar</div>

    <!-- Visibility -->
    <div class="form-group">
      <label class="form-label">Ko'rinish</label>
      <div class="vis-grid">
        <button class="vis-btn active" id="vis-public" onclick="setVis('public')">
          <span class="vis-icon">üåê</span>Ommaviy
        </button>
        <button class="vis-btn" id="vis-private" onclick="setVis('private')">
          <span class="vis-icon">üîí</span>Shaxsiy
        </button>
      </div>
      <div style="padding:.55rem .8rem;border-radius:10px;
        background:rgba(79,70,229,.07);border:1px dashed rgba(79,70,229,.28);
        font-size:.76rem;color:var(--accent);font-weight:600">
        üîë Barcha testlar ulashish kodi bilan birga saqlanadi
      </div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:.75rem;margin-top:.75rem">
      <div class="form-group" style="margin:0">
        <label class="form-label">Vaqt (daqiqa)</label>
        <input id="t-time" type="number" class="form-input" value="0" min="0" max="180" placeholder="0=cheksiz"/>
      </div>
      <div class="form-group" style="margin:0">
        <label class="form-label">O'tish bali (%)</label>
        <input id="t-pass" type="number" class="form-input" value="60" min="0" max="100"/>
      </div>
    </div>

    <div style="margin-top:.85rem">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.6rem">
        <span class="form-label" style="margin:0">Savollarni aralashtirish</span>
        <label class="toggle"><input type="checkbox" id="t-shuffle"/><span class="toggle-slider"></span></label>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center">
        <span class="form-label" style="margin:0">Natijani ko'rsatish</span>
        <label class="toggle"><input type="checkbox" id="t-result" checked/><span class="toggle-slider"></span></label>
      </div>
    </div>

    <!-- Q count + Save -->
    <div style="text-align:center;padding:.65rem;
      background:var(--bg-2);border-radius:12px;margin-top:.85rem;margin-bottom:.85rem">
      <div style="font-family:'Unbounded',sans-serif;font-size:1.35rem;font-weight:900;color:var(--accent)" id="q-count">0</div>
      <div style="font-size:.7rem;color:var(--text-3);font-weight:600">ta savol</div>
    </div>
    <button class="btn btn-primary" style="width:100%;justify-content:center" id="save-btn-2">üíæ Saqlash</button>
  </div>

  <!-- QUESTIONS -->
  <div id="q-container"></div>

  <!-- ADD QUESTION -->
  <div class="add-area">
    <div class="add-area-label">‚ûï Savol turi tanlang</div>
    <div class="add-q-grid">
      <button class="aqbtn aqbtn-m" onclick="addQ('multiple')">
        <span style="font-size:1.3rem">‚≠ï</span>Ko'p tanlov
      </button>
      <button class="aqbtn aqbtn-t" onclick="addQ('truefalse')">
        <span style="font-size:1.3rem">‚úÖ</span>Ha / Yo'q
      </button>
      <button class="aqbtn aqbtn-x" onclick="addQ('text')">
        <span style="font-size:1.3rem">üìù</span>Matn
      </button>
    </div>
  </div>

</div>
</main>

<!-- IMPORT MODAL -->
<div class="imp-modal-bg" id="imp-modal">
  <div class="imp-box">
    <div class="imp-hdr">
      <span style="font-size:.95rem;font-weight:800">üì• Savollarni import qilish</span>
      <button onclick="closeImport()"
        style="background:none;border:1px solid var(--border-2);border-radius:8px;
          width:28px;height:28px;cursor:pointer;font-size:.82rem;color:var(--text-3)">‚úï</button>
    </div>
    <div class="imp-body">
      <!-- Tab: Text / File -->
      <div class="imp-tabs">
        <button class="impt on" id="impt-txt" onclick="switchTab('txt')">üìù Matn yozish</button>
        <button class="impt" id="impt-file" onclick="switchTab('file')">üìÅ Fayl yuklash</button>
      </div>

      <!-- TEXT TAB -->
      <div id="imp-txt-body">
        <div class="fmt-tabs">
          <button class="fmtt on" onclick="showFmt(0,this)">A) * format</button>
          <button class="fmtt" onclick="showFmt(1,this)">1) [+] format</button>
          <button class="fmtt" onclick="showFmt(2,this)">Ha/Yo'q</button>
        </div>
        <div class="fmt-preview" id="fmt-preview"></div>
        <div style="font-size:.71rem;color:var(--text-3);margin-bottom:.65rem">
          üí° <b>*</b> yoki <b>[+]</b> = to'g'ri javob &nbsp;¬∑&nbsp; <b>Izoh:</b> = tushuntirish (ixtiyoriy)
        </div>
        <div class="form-group">
          <label class="form-label">Savollarni kiriting:</label>
          <textarea id="imp-textarea" class="form-input"
            rows="9" style="font-family:monospace;font-size:.82rem;resize:vertical"
            placeholder="1. Savol matni?&#10;A) Variant&#10;B) To'g'ri javob *&#10;C) Variant&#10;D) Variant&#10;Izoh: Tushuntirish..."></textarea>
        </div>
        <div style="display:flex;gap:.65rem;justify-content:flex-end">
          <button class="btn btn-ghost" onclick="closeImport()">Bekor</button>
          <button class="btn btn-primary" onclick="doImport()">‚úÖ Importlash</button>
        </div>
      </div>

      <!-- FILE TAB -->
      <div id="imp-file-body" style="display:none">
        <div class="drop-zone" id="drop-zone">
          <div style="font-size:2rem;margin-bottom:.55rem;pointer-events:none">üìÅ</div>
          <div style="font-weight:800;font-size:.92rem;margin-bottom:.3rem;pointer-events:none">
            Faylni bu yerga tashlang
          </div>
          <div style="font-size:.77rem;color:var(--text-3);pointer-events:none">yoki quyidagi tugmani bosing</div>
          <label class="drop-label" for="file-input">üìÇ .txt fayl tanlash</label>
          <input type="file" id="file-input" accept=".txt,.text" style="display:none" onchange="handleFile(this)"/>
          <div style="font-size:.7rem;color:var(--text-3);margin-top:.65rem;pointer-events:none">Format: .txt</div>
        </div>
        <div id="file-result" style="margin-top:.75rem"></div>
        <div style="display:flex;justify-content:flex-end;margin-top:.75rem">
          <button class="btn btn-ghost" onclick="closeImport()">Yopish</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="js/firebase.js"></script>
<script src="js/theme.js"></script>
<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let questions    = [];
let selectedSubj = '';
let selectedVis  = 'public';
let currentUser  = null;
let editId       = null;

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INIT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
(async () => {
  currentUser = await AuthHelpers.requireAuth('login.html');
  if (!currentUser) return;

  const prof = await DB.getUser(currentUser.uid).catch(() => null);
  const name = prof?.name || currentUser.displayName || 'U';
  document.getElementById('side-name').textContent = name;
  document.getElementById('side-ava').textContent  = name[0].toUpperCase();

  buildSubjGrid();
  setVis('public');
  initFmtPreviews();

  const params = new URLSearchParams(location.search);
  editId = params.get('id');
  if (editId) {
    document.getElementById('page-title').textContent = 'Testni tahrirlash';
    await loadEdit(editId);
  } else {
    addQ('multiple');
  }
})();

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SUBJECT GRID
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function buildSubjGrid() {
  const grid = document.getElementById('subj-grid');
  Object.entries(SUBJECTS).forEach(([key, s]) => {
    const btn = document.createElement('button');
    btn.className = 'subj-btn';
    btn.dataset.key = key;
    btn.innerHTML = `<span class="sb-emoji">${s.emoji}</span>${s.label}`;
    btn.onclick = () => {
      document.querySelectorAll('.subj-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      selectedSubj = key;
      showSelSubj(key);
    };
    grid.appendChild(btn);
  });
}

function showSelSubj(key) {
  const el = document.getElementById('selected-subj-wrap');
  if (!key) { el.style.display = 'none'; return; }
  const s = getSubject(key);
  el.style.display = 'block';
  el.innerHTML = `<span style="font-size:.78rem;color:var(--text-3)">Tanlangan: </span>
    <strong style="font-size:.82rem;color:var(--accent)">${s.emoji} ${s.label}</strong>`;
}

window.setCustomSubj = () => {
  const val = document.getElementById('custom-subj').value.trim();
  if (!val) return;
  document.querySelectorAll('.subj-btn').forEach(b => b.classList.remove('active'));
  selectedSubj = val.toLowerCase().replace(/\s+/g, '-
