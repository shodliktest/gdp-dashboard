<!DOCTYPE html>
<html lang="uz" data-theme="light">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>TestPro ‚Äî Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Unbounded:wght@700;800;900&display=swap" rel="stylesheet"/>
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
:root{--bg:#EEF0FF;--card:#fff;--text:#1a1a2e;--text2:#6b7280;--text3:#9ca3af;
  --acc:#6C3FE8;--acc2:#C040C8;--border:rgba(108,63,232,.1);
  --shadow:0 2px 10px rgba(108,63,232,.07)}
[data-theme=dark]{--bg:#0d0820;--card:#140d28;--text:#e8e0ff;--text2:#9ca3af;--text3:#6b7280;
  --border:rgba(108,63,232,.2);--shadow:0 2px 12px rgba(0,0,0,.35)}
body{font-family:'Plus Jakarta Sans',sans-serif;min-height:100vh;background:var(--bg);color:var(--text);overflow-x:hidden}

/* NAV */
.nav{position:fixed;top:0;left:0;right:0;height:54px;z-index:500;
  display:flex;align-items:center;justify-content:space-between;padding:0 1rem;background:var(--bg)}
.logo{font-family:'Unbounded',sans-serif;font-size:1.1rem;font-weight:900;cursor:pointer;
  background:linear-gradient(135deg,var(--acc),var(--acc2));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.nav-r{display:flex;align-items:center;gap:.4rem}
.ava{width:34px;height:34px;border-radius:50%;
  background:linear-gradient(135deg,var(--acc),var(--acc2));
  border:none;cursor:pointer;color:#fff;font-weight:900;font-size:.8rem;font-family:'Unbounded',sans-serif;
  overflow:hidden;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.ava img{width:100%;height:100%;object-fit:cover;border-radius:50%}
.ibtn{width:34px;height:34px;border-radius:99px;border:none;cursor:pointer;font-size:.88rem;
  background:rgba(255,255,255,.8);display:flex;align-items:center;justify-content:center;transition:all .2s}
[data-theme=dark] .ibtn{background:rgba(255,255,255,.1)}
.mbtn{width:34px;height:34px;border-radius:10px;border:none;cursor:pointer;
  background:rgba(255,255,255,.8);display:flex;align-items:center;justify-content:center}
[data-theme=dark] .mbtn{background:rgba(255,255,255,.1)}
.lines{display:flex;flex-direction:column;gap:4px;pointer-events:none}
.lines span{width:16px;height:2px;background:var(--text2);border-radius:2px;display:block;transition:all .3s}

/* MENU */
.ov{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:800}
.ov.on{display:block}
.panel{position:fixed;top:0;right:-260px;width:240px;height:100vh;z-index:900;
  background:var(--card);border-left:1px solid var(--border);
  transition:right .28s cubic-bezier(.16,1,.3,1);
  display:flex;flex-direction:column}
.panel.on{right:0}
.p-head{background:linear-gradient(135deg,var(--acc),var(--acc2));
  padding:1.1rem 1rem .9rem;display:flex;align-items:center;gap:.6rem;position:relative;min-height:88px}
.p-ava{width:44px;height:44px;border-radius:50%;background:rgba(255,255,255,.25);
  border:2px solid rgba(255,255,255,.6);display:flex;align-items:center;justify-content:center;
  font-weight:900;color:#fff;font-size:.9rem;font-family:'Unbounded',sans-serif;flex-shrink:0;overflow:hidden}
.p-ava img{width:100%;height:100%;object-fit:cover;border-radius:50%}
.p-nm{font-size:.86rem;font-weight:800;color:#fff;margin-bottom:.12rem}
.p-role{font-size:.68rem;color:rgba(255,255,255,.75);font-weight:600}
.p-close{position:absolute;top:.65rem;right:.65rem;width:27px;height:27px;border-radius:7px;
  border:none;background:rgba(255,255,255,.2);cursor:pointer;color:#fff;font-size:.82rem;
  display:flex;align-items:center;justify-content:center}
.p-body{flex:1;overflow-y:auto;padding:.6rem .65rem}
.ml{display:flex;align-items:center;gap:.55rem;padding:.65rem .75rem;border-radius:11px;
  font-size:.82rem;font-weight:700;cursor:pointer;background:none;border:none;
  font-family:inherit;color:var(--text2);width:100%;text-align:left;transition:all .18s;margin-bottom:.18rem}
.ml:hover,.ml.on{background:rgba(108,63,232,.1);color:var(--acc)}
.ml .mi{width:20px;text-align:center;flex-shrink:0;font-size:.92rem}
.p-foot{padding:.7rem;border-top:1px solid var(--border)}
.lout{width:100%;padding:.62rem;border-radius:11px;border:1px solid rgba(239,68,68,.22);
  background:rgba(239,68,68,.07);color:#ef4444;font-weight:700;font-size:.82rem;
  cursor:pointer;font-family:inherit;transition:all .2s}
.lout:hover{background:rgba(239,68,68,.15)}

/* PAGE */
.page{padding:66px 0 3rem}
.w{padding:0 1rem}

/* GREET */
.greet{padding:.85rem 0 .5rem}
.greet-h{font-family:'Unbounded',sans-serif;font-size:1rem;font-weight:900;margin-bottom:.08rem}
.greet-p{font-size:.72rem;color:var(--text3)}

/* STATS */
.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:.45rem;margin:.7rem 0}
.sb{background:var(--card);border-radius:14px;padding:.75rem .5rem;text-align:center;
  border:1px solid var(--border);box-shadow:var(--shadow)}
.sv{font-family:'Unbounded',sans-serif;font-size:1.2rem;font-weight:900;
  background:linear-gradient(135deg,var(--acc),var(--acc2));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.sl{font-size:.58rem;color:var(--text3);text-transform:uppercase;letter-spacing:.06em;font-weight:700;margin-top:.08rem}

/* SECTION */
.sec{margin-bottom:1.2rem}
.sec-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:.6rem}
.sec-t{font-size:.88rem;font-weight:800;display:flex;align-items:center;gap:.3rem}
.sec-t span{font-size:.7rem;font-weight:600;color:var(--text3)}
.sec-new{padding:.3rem .75rem;border-radius:99px;font-size:.74rem;font-weight:700;
  cursor:pointer;border:none;font-family:inherit;
  background:linear-gradient(135deg,var(--acc),var(--acc2));color:#fff;transition:all .2s}
.sec-new:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(108,63,232,.3)}
.sec-link{font-size:.74rem;font-weight:700;color:var(--acc);cursor:pointer;background:none;border:none;font-family:inherit}

/* MY TEST ITEM */
.ti{background:var(--card);border:1.5px solid var(--border);border-radius:15px;
  padding:.85rem;margin-bottom:.5rem;transition:all .2s}
.ti:hover{border-color:rgba(108,63,232,.3);box-shadow:0 4px 14px rgba(108,63,232,.1)}
.ti-row{display:flex;align-items:flex-start;gap:.55rem}
.ti-info{flex:1;min-width:0}
.ti-nm{font-size:.86rem;font-weight:800;color:var(--text);
  overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-bottom:.18rem}
.ti-mt{font-size:.7rem;color:var(--text3);display:flex;gap:.42rem;flex-wrap:wrap}
.vtag{display:inline-block;padding:.12rem .45rem;border-radius:99px;font-size:.6rem;font-weight:700;margin-top:.28rem}
.vt-pub{background:rgba(16,185,129,.1);color:#059669;border:1px solid rgba(16,185,129,.2)}
.vt-priv{background:rgba(245,158,11,.1);color:#d97706;border:1px solid rgba(245,158,11,.22)}
.vt-code{background:rgba(108,63,232,.1);color:var(--acc);border:1px solid rgba(108,63,232,.22)}
.ti-acts{display:flex;gap:.28rem;flex-shrink:0}
.ab{width:30px;height:30px;border-radius:8px;border:1px solid var(--border);
  background:var(--card);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.82rem;transition:all .2s}
.ab:hover{background:rgba(108,63,232,.1);border-color:rgba(108,63,232,.3)}
.ab-del{background:rgba(239,68,68,.07);border-color:rgba(239,68,68,.2)}
.ab-del:hover{background:rgba(239,68,68,.18)}
.share-row{display:flex;align-items:center;gap:.45rem;margin-top:.45rem;
  padding:.38rem .6rem;background:rgba(108,63,232,.05);
  border:1px dashed rgba(108,63,232,.25);border-radius:8px}
.sh-code{font-family:'Unbounded',sans-serif;font-size:.8rem;font-weight:900;
  color:var(--acc);letter-spacing:.1em;flex:1}
.cp-btn{padding:.2rem .5rem;border-radius:6px;border:1px solid rgba(108,63,232,.25);
  background:rgba(108,63,232,.08);color:var(--acc);font-size:.63rem;font-weight:700;
  cursor:pointer;font-family:inherit;white-space:nowrap;transition:all .2s}
.cp-btn:hover{background:rgba(108,63,232,.18)}

/* PUBLIC CARDS ‚Äî same as index */
.grp{margin-bottom:1.2rem}
.grp-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:.55rem}
.grp-l{display:flex;align-items:center;gap:.58rem}
.grp-icon{width:40px;height:40px;border-radius:12px;
  background:rgba(255,255,255,.9);box-shadow:0 2px 8px rgba(0,0,0,.07);
  display:flex;align-items:center;justify-content:center;font-size:1.35rem}
[data-theme=dark] .grp-icon{background:rgba(255,255,255,.1)}
.grp-nm{font-size:.82rem;font-weight:800;color:var(--text)}
.grp-ct{font-size:.68rem;color:var(--text3);font-weight:600}
.scroll{display:flex;gap:.65rem;overflow-x:auto;padding-bottom:.35rem;
  scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch}
.scroll::-webkit-scrollbar{display:none}
.card{min-width:165px;max-width:165px;flex-shrink:0;scroll-snap-align:start;
  background:var(--card);border-radius:16px;padding:.85rem;
  border:1.5px solid var(--border);box-shadow:var(--shadow);
  cursor:pointer;transition:transform .2s,box-shadow .2s;display:flex;flex-direction:column}
.card:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(108,63,232,.15)}
.card-icon{width:42px;height:42px;border-radius:12px;background:var(--bg);
  display:flex;align-items:center;justify-content:center;font-size:1.35rem;margin-bottom:.55rem}
.card-t{font-size:.82rem;font-weight:800;color:var(--text);margin-bottom:.12rem;
  overflow:hidden;text-overflow:ellipsis;display:-webkit-box;
  -webkit-line-clamp:2;-webkit-box-orient:vertical;line-height:1.35}
.card-au{font-size:.65rem;color:var(--text3);margin-bottom:.38rem;
  overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.chips{display:flex;gap:.25rem;flex-wrap:wrap;margin-bottom:.5rem}
.ch{display:inline-flex;align-items:center;padding:.13rem .38rem;border-radius:99px;
  font-size:.62rem;font-weight:600;background:rgba(108,63,232,.07);color:var(--acc);
  border:1px solid rgba(108,63,232,.1)}
[data-theme=dark] .ch{background:rgba(108,63,232,.2)}
.card-btn{display:block;width:100%;padding:.55rem;border-radius:10px;border:none;
  cursor:pointer;background:linear-gradient(135deg,var(--acc),var(--acc2));color:#fff;
  font-family:inherit;font-size:.78rem;font-weight:700;text-align:center;transition:all .2s;margin-top:auto}
.card-btn:hover{box-shadow:0 4px 12px rgba(108,63,232,.3)}

/* RESULTS */
.ri{background:var(--card);border:1px solid var(--border);border-radius:12px;
  padding:.7rem .85rem;margin-bottom:.4rem;
  display:flex;align-items:center;justify-content:space-between;gap:.5rem}
.ri-nm{font-size:.83rem;font-weight:700;color:var(--text);margin-bottom:.1rem}
.ri-dt{font-size:.68rem;color:var(--text3)}
.ri-sc{font-family:'Unbounded',sans-serif;font-size:.88rem;font-weight:900;flex-shrink:0}
.sc-g{color:#10b981}.sc-a{color:#f59e0b}.sc-r{color:#ef4444}

/* QUICK ACTIONS */
.qa-wrap{display:flex;flex-direction:column;gap:.45rem}
.qa{display:flex;align-items:center;justify-content:center;gap:.4rem;width:100%;
  padding:.76rem;border-radius:13px;font-family:inherit;font-size:.84rem;font-weight:700;
  cursor:pointer;border:none;transition:all .2s}
.qa-p{background:linear-gradient(135deg,var(--acc),var(--acc2));color:#fff}
.qa-p:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(108,63,232,.32)}
.qa-s{background:var(--card);border:1.5px solid var(--border);color:var(--text2)}
.qa-s:hover{border-color:rgba(108,63,232,.4);color:var(--acc)}

/* CODE MODAL */
.modal-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:1000;
  align-items:center;justify-content:center;padding:1rem}
.modal-bg.on{display:flex}
.modal{background:var(--card);border-radius:20px;padding:1.35rem;width:100%;max-width:300px;
  box-shadow:0 20px 60px rgba(0,0,0,.25)}
.ci{width:36px;height:42px;text-align:center;font-family:'Unbounded',sans-serif;
  font-weight:900;font-size:1rem;border:2px solid rgba(108,63,232,.2);border-radius:8px;
  background:rgba(108,63,232,.04);color:var(--text);outline:none;transition:border-color .2s}
.ci:focus{border-color:var(--acc)}

/* THEME SWITCH */
.sw{position:relative;display:inline-block;width:38px;height:20px}
.sw input{opacity:0;width:0;height:0}
.sw-s{position:absolute;cursor:pointer;inset:0;background:rgba(0,0,0,.15);border-radius:99px;transition:.3s}
.sw-s::before{content:'';position:absolute;width:14px;height:14px;left:3px;top:3px;
  background:#fff;border-radius:50%;transition:.3s}
.sw input:checked+.sw-s{background:linear-gradient(135deg,var(--acc),var(--acc2))}
.sw input:checked+.sw-s::before{transform:translateX(18px)}

/* TOAST */
.toast{position:fixed;bottom:1.2rem;left:50%;transform:translateX(-50%);
  background:rgba(10,5,25,.9);color:#fff;padding:.58rem 1rem;border-radius:11px;
  font-size:.78rem;font-weight:600;z-index:9999;backdrop-filter:blur(12px);
  white-space:nowrap;animation:fau .3s ease both}
@keyframes fau{from{opacity:0;transform:translateX(-50%) translateY(8px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}

/* LOADER / EMPTY */
.sp{width:26px;height:26px;border:3px solid rgba(108,63,232,.15);border-top-color:var(--acc);
  border-radius:50%;animation:spin .7s linear infinite;margin:1.5rem auto}
@keyframes spin{to{transform:rotate(360deg)}}
.emp{text-align:center;padding:1rem;color:var(--text3);font-size:.78rem}
.err{color:#ef4444;font-size:.78rem;text-align:center;padding:1rem}
.divider{height:1px;background:var(--border);margin:.6rem 0}
</style>
</head>
<body>

<!-- NAV -->
<nav class="nav">
  <div class="logo" onclick="goTo('index.html')">TestPro</div>
  <div class="nav-r">
    <div class="ava" id="nav-ava" onclick="goTo('profile.html')">?</div>
    <button class="ibtn" id="tbtn">üåô</button>
    <button class="mbtn" id="mbtn">
      <div class="lines"><span></span><span></span><span></span></div>
    </button>
  </div>
</nav>

<!-- OVERLAY + PANEL -->
<div class="ov" id="ov"></div>
<div class="panel" id="panel">
  <div class="p-head">
    <div class="p-ava" id="p-ava">?</div>
    <div>
      <div class="p-nm" id="p-nm">...</div>
      <div class="p-role" id="p-role">Foydalanuvchi</div>
    </div>
    <button class="p-close" id="pcl">‚úï</button>
  </div>
  <div class="p-body">
    <button class="ml on" onclick="closeMenu()"><span class="mi">üìä</span> Dashboard</button>
    <button class="ml" onclick="closeMenu();goTo('create.html')"><span class="mi">‚úèÔ∏è</span> Yangi test</button>
    <button class="ml" onclick="closeMenu();goTo('history.html')"><span class="mi">üìú</span> Tarix</button>
    <button class="ml" onclick="closeMenu();goTo('profile.html')"><span class="mi">üë§</span> Profil</button>
    <button class="ml" onclick="closeMenu();goTo('index.html')"><span class="mi">üåê</span> Bosh sahifa</button>
    <div id="admin-wrap"></div>
    <div class="divider"></div>
    <div style="display:flex;align-items:center;justify-content:space-between;padding:.55rem .75rem">
      <span style="font-size:.82rem;font-weight:600;color:var(--text2)">üåô Tungi rejim</span>
      <label class="sw"><input type="checkbox" id="sw1"/><span class="sw-s"></span></label>
    </div>
  </div>
  <div class="p-foot">
    <button class="lout" id="lout">üö™ Chiqish</button>
  </div>
</div>

<!-- PAGE -->
<div class="page">
<div class="w">

  <div class="greet">
    <div class="greet-h" id="greet-h">Salom! üëã</div>
    <div class="greet-p">Bugun ham muvaffaqiyat!</div>
  </div>

  <div class="stats">
    <div class="sb"><div class="sv" id="s-t">0</div><div class="sl">Testlarim</div></div>
    <div class="sb"><div class="sv" id="s-d">0</div><div class="sl">Ishlangan</div></div>
    <div class="sb"><div class="sv" id="s-a">‚Äî</div><div class="sl">O'rtacha</div></div>
  </div>

  <!-- MY TESTS -->
  <div class="sec">
    <div class="sec-hdr">
      <div class="sec-t">üìù Mening testlarim</div>
      <button class="sec-new" onclick="goTo('create.html')">+ Yangi</button>
    </div>
    <div id="my-tests"><div class="sp"></div></div>
  </div>

  <!-- PUBLIC TESTS -->
  <div class="sec">
    <div class="sec-hdr">
      <div class="sec-t">üåê Ommaviy testlar <span id="pub-cnt"></span></div>
    </div>
    <div id="pub-tests"><div class="sp"></div></div>
  </div>

  <!-- RESULTS -->
  <div class="sec" id="res-sec" style="display:none">
    <div class="sec-hdr">
      <div class="sec-t">üèÜ So'nggi natijalar</div>
      <button class="sec-link" onclick="goTo('history.html')">Barchasi ‚Üí</button>
    </div>
    <div id="res-list"></div>
  </div>

  <!-- QUICK ACTIONS -->
  <div class="sec">
    <div class="sec-t" style="margin-bottom:.55rem">‚ö° Tezkor</div>
    <div class="qa-wrap">
      <button class="qa qa-p" onclick="goTo('create.html')">‚úèÔ∏è Yangi test yaratish</button>
      <button class="qa qa-s" onclick="openCode()">üîë Kod orqali kirish</button>
    </div>
  </div>

  <!-- THEME ROW -->
  <div style="background:var(--card);border:1px solid var(--border);border-radius:13px;
    padding:.7rem 1rem;display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem">
    <span style="font-size:.77rem;color:var(--text3);font-weight:600">Interfeys rejimi</span>
    <label class="sw"><input type="checkbox" id="sw2"/><span class="sw-s"></span></label>
  </div>

</div>
</div>

<!-- CODE MODAL -->
<div class="modal-bg" id="code-bg">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.8rem">
      <div style="font-weight:800;font-size:.9rem">üîë Kod kiritish</div>
      <button onclick="closeCode()" style="background:none;border:none;cursor:pointer;color:var(--text3);font-size:.9rem">‚úï</button>
    </div>
    <p style="font-size:.75rem;color:var(--text3);margin-bottom:.72rem">6 xonali ulashish kodini kiriting:</p>
    <div style="display:flex;gap:.28rem;justify-content:center;margin-bottom:.7rem">
      <input class="ci" maxlength="1"/><input class="ci" maxlength="1"/><input class="ci" maxlength="1"/>
      <input class="ci" maxlength="1"/><input class="ci" maxlength="1"/><input class="ci" maxlength="1"/>
    </div>
    <div id="code-msg" style="min-height:14px;font-size:.73rem;text-align:center;margin-bottom:.65rem;font-weight:600;color:var(--text3)"></div>
    <button onclick="doCode()"
      style="width:100%;padding:.75rem;border-radius:11px;border:none;
        background:linear-gradient(135deg,var(--acc),var(--acc2));color:#fff;
        font-weight:700;font-size:.84rem;cursor:pointer;font-family:inherit">
      Qidirish ‚Üí
    </button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="js/firebase.js"></script>
<script>
/* ‚îÄ‚îÄ THEME ‚îÄ‚îÄ */
const TH={
  get(){return localStorage.getItem('tp_theme')||(matchMedia('(prefers-color-scheme:dark)').matches?'dark':'light')},
  set(t){
    document.documentElement.setAttribute('data-theme',t);localStorage.setItem('tp_theme',t);
    const b=document.getElementById('tbtn');if(b)b.textContent=t==='dark'?'‚òÄÔ∏è':'üåô';
    const s1=document.getElementById('sw1');const s2=document.getElementById('sw2');
    if(s1)s1.checked=t==='dark';if(s2)s2.checked=t==='dark';
  },
  toggle(){this.set(this.get()==='dark'?'light':'dark')}
};
TH.set(TH.get());
document.getElementById('tbtn').onclick=()=>TH.toggle();
document.getElementById('sw1').onchange=()=>TH.toggle();
document.getElementById('sw2').onchange=()=>TH.toggle();

/* ‚îÄ‚îÄ MENU ‚îÄ‚îÄ */
const panel=document.getElementById('panel');
const ov=document.getElementById('ov');
function openMenu(){panel.classList.add('on');ov.classList.add('on');}
function closeMenu(){panel.classList.remove('on');ov.classList.remove('on');}
document.getElementById('mbtn').onclick=openMenu;
document.getElementById('pcl').onclick=closeMenu;
ov.onclick=closeMenu;

/* ‚îÄ‚îÄ LOGOUT ‚îÄ‚îÄ */
document.getElementById('lout').onclick=async()=>{
  await auth.
