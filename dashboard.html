<!DOCTYPE html>
<html lang="uz" data-theme="light">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>TestPro ‚Äî Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Unbounded:wght@700;800;900&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{-webkit-tap-highlight-color:transparent}
body{font-family:'Plus Jakarta Sans',sans-serif;min-height:100vh;background:linear-gradient(135deg,#f5f3ff 0%,#fce7f3 50%,#eff6ff 100%);color:#1a1a2e;-webkit-font-smoothing:antialiased;overflow-x:hidden}
[data-theme="dark"] body{background:linear-gradient(135deg,#0d0820 0%,#140a20 50%,#080d1a 100%);color:#e8e0ff}
a{text-decoration:none;color:inherit}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:rgba(124,58,237,.35);border-radius:9px}

/* NAV */
.nav{position:fixed;top:0;left:0;right:0;height:60px;z-index:900;display:flex;align-items:center;justify-content:space-between;padding:0 1rem;background:rgba(245,243,255,.88);backdrop-filter:blur(20px);border-bottom:1px solid rgba(124,58,237,.1)}
[data-theme="dark"] .nav{background:rgba(13,8,32,.9);border-color:rgba(124,58,237,.15)}
.nav-logo{font-family:'Unbounded',sans-serif;font-size:1.25rem;font-weight:900;background:linear-gradient(135deg,#7c3aed,#ec4899);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;cursor:pointer}
.nav-r{display:flex;align-items:center;gap:.6rem}
.nav-uname{font-size:.78rem;font-weight:700;color:#374151;max-width:90px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
[data-theme="dark"] .nav-uname{color:#c4b5fd}
.ava{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,#7c3aed,#ec4899);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:.82rem;cursor:pointer;overflow:hidden;flex-shrink:0}
.ava img{width:100%;height:100%;object-fit:cover}
.icon-btn{width:34px;height:34px;border-radius:9px;border:1px solid rgba(0,0,0,.09);background:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.9rem;transition:all .2s}
[data-theme="dark"] .icon-btn{background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.12)}
.icon-btn:hover{background:rgba(124,58,237,.1);border-color:rgba(124,58,237,.3)}
.hamburger-icon{display:flex;flex-direction:column;gap:4px;pointer-events:none}
.hamburger-icon span{width:16px;height:2px;background:#6b7280;border-radius:2px;display:block;transition:all .25s}
[data-theme="dark"] .hamburger-icon span{background:#9ca3af}

/* PAGE */
.page{padding:60px 0 3rem}
.wrap{max-width:460px;margin:0 auto;padding:1rem .9rem 0}

/* STATS */
.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:.55rem;margin:.9rem 0}
.st{background:rgba(255,255,255,.75);border:1px solid rgba(255,255,255,.6);border-radius:14px;padding:.8rem .5rem;text-align:center;backdrop-filter:blur(8px)}
[data-theme="dark"] .st{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.09)}
.st-v{font-family:'Unbounded',sans-serif;font-size:1.35rem;font-weight:900;background:linear-gradient(135deg,#7c3aed,#ec4899);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1.1}
.st-l{font-size:.62rem;color:#9ca3af;text-transform:uppercase;letter-spacing:.06em;font-weight:700;margin-top:.15rem}

/* CARD */
.card{background:rgba(255,255,255,.78);border:1px solid rgba(255,255,255,.6);border-radius:18px;padding:1rem;margin-bottom:.9rem;backdrop-filter:blur(10px)}
[data-theme="dark"] .card{background:rgba(255,255,255,.05);border-color:rgba(255,255,255,.08)}
.card-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:.8rem;gap:.5rem}
.card-title{font-size:.92rem;font-weight:800;display:flex;align-items:center;gap:.35rem}
.cnt-badge{font-size:.7rem;font-weight:700;padding:.18rem .55rem;border-radius:99px;background:rgba(124,58,237,.1);color:#7c3aed;border:1px solid rgba(124,58,237,.18)}

/* TEST ITEM */
.ti{background:#fff;border:1px solid rgba(0,0,0,.07);border-radius:13px;padding:.9rem;margin-bottom:.6rem;transition:box-shadow .2s,transform .2s}
[data-theme="dark"] .ti{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.1)}
.ti:hover{box-shadow:0 4px 16px rgba(124,58,237,.12);transform:translateY(-1px)}
.ti-row{display:flex;align-items:center;justify-content:space-between;gap:.5rem}
.ti-name{font-size:.88rem;font-weight:700;color:#111827;margin-bottom:.28rem;line-height:1.3}
[data-theme="dark"] .ti-name{color:#e5e7eb}
.ti-meta{font-size:.72rem;color:#9ca3af;display:flex;gap:.6rem;flex-wrap:wrap;align-items:center}
.vis-tag{display:inline-block;padding:.15rem .5rem;border-radius:99px;font-size:.65rem;font-weight:700;margin-top:.3rem}
.vt-priv{background:rgba(245,158,11,.12);color:#d97706;border:1px solid rgba(245,158,11,.25)}
.vt-pub{background:rgba(16,185,129,.12);color:#059669;border:1px solid rgba(16,185,129,.2)}
.ti-acts{display:flex;gap:.35rem;flex-shrink:0;align-items:center}
.sm-btn{width:34px;height:34px;border-radius:9px;border:1px solid rgba(0,0,0,.08);background:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.9rem;transition:all .2s;text-decoration:none}
[data-theme="dark"] .sm-btn{background:rgba(255,255,255,.09);border-color:rgba(255,255,255,.13)}
.sm-btn:hover{background:rgba(124,58,237,.1);border-color:rgba(124,58,237,.3)}
.sm-del{background:linear-gradient(135deg,#ef4444,#f97316);border:none;color:#fff}
.sm-del:hover{opacity:.85;transform:scale(1.05)}

/* SHARE ROW */
.share-row{display:flex;align-items:center;gap:.5rem;margin-top:.55rem;padding:.5rem .75rem;background:rgba(124,58,237,.06);border:1px dashed rgba(124,58,237,.28);border-radius:9px}
.share-code{font-family:'Unbounded',sans-serif;font-size:.88rem;font-weight:900;color:#7c3aed;letter-spacing:.12em;flex:1}
.copy-btn{padding:.28rem .65rem;border-radius:7px;border:1px solid rgba(124,58,237,.3);background:rgba(124,58,237,.08);color:#7c3aed;font-size:.68rem;font-weight:700;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;white-space:nowrap;transition:all .2s}
.copy-btn:hover{background:rgba(124,58,237,.18)}

/* GRADIENT BTN */
.g-btn{padding:.58rem 1rem;border-radius:11px;border:none;cursor:pointer;background:linear-gradient(135deg,#7c3aed,#ec4899);color:#fff;font-family:'Plus Jakarta Sans',sans-serif;font-size:.8rem;font-weight:700;transition:all .2s;white-space:nowrap;display:inline-flex;align-items:center;gap:.3rem;text-decoration:none}
.g-btn:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(124,58,237,.32)}

/* PUBLIC SWIPE GROUPS */
.pub-group{margin-bottom:1rem}
.grp-label{font-size:.75rem;font-weight:800;text-transform:uppercase;letter-spacing:.08em;color:#9ca3af;margin-bottom:.45rem;display:flex;align-items:center;gap:.35rem;padding:0 .15rem}
[data-theme="dark"] .grp-label{color:#6b7280}
.grp-label .grp-cnt{font-size:.68rem;background:rgba(124,58,237,.1);color:#7c3aed;border-radius:99px;padding:.1rem .45rem;font-weight:700}
.swipe-outer{overflow:hidden;border-radius:13px;position:relative}
.swipe-rail{display:flex;transition:transform .32s cubic-bezier(.16,1,.3,1)}
.swipe-card{min-width:100%;background:#fff;border:1.5px solid rgba(0,0,0,.07);border-radius:13px;padding:.9rem;flex-shrink:0}
[data-theme="dark"] .swipe-card{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.1)}
.swipe-card .ti-name{margin-bottom:.3rem}
.swipe-bottom{display:flex;align-items:center;justify-content:space-between;margin-top:.6rem}
.dots{display:flex;gap:4px;align-items:center}
.dot{width:6px;height:6px;border-radius:50%;background:rgba(124,58,237,.2);cursor:pointer;transition:all .2s}
.dot.on{background:#7c3aed;width:16px;border-radius:99px}
.arr-btns{display:flex;gap:.35rem}
.arr{width:28px;height:28px;border-radius:50%;border:1px solid rgba(124,58,237,.2);background:rgba(124,58,237,.07);color:#7c3aed;cursor:pointer;font-size:.8rem;display:flex;align-items:center;justify-content:center;transition:all .2s}
.arr:hover:not(:disabled){background:rgba(124,58,237,.18)}
.arr:disabled{opacity:.3;cursor:default}

/* RESULTS */
.ri{background:#fff;border:1px solid rgba(0,0,0,.07);border-radius:13px;padding:.8rem .9rem;margin-bottom:.55rem;display:flex;align-items:center;justify-content:space-between;gap:.5rem}
[data-theme="dark"] .ri{background:rgba(255,255,255,.05);border-color:rgba(255,255,255,.09)}
.ri-name{font-size:.86rem;font-weight:700;color:#111827;margin-bottom:.18rem}
[data-theme="dark"] .ri-name{color:#e5e7eb}
.ri-date{font-size:.7rem;color:#9ca3af}
.ri-score{font-family:'Unbounded',sans-serif;font-size:1rem;font-weight:900}
.sc-r{color:#ef4444}.sc-a{color:#f59e0b}.sc-g{color:#10b981}

/* QUICK */
.qa{display:flex;align-items:center;justify-content:center;gap:.45rem;width:100%;padding:.82rem;border-radius:13px;border:none;font-family:'Plus Jakarta Sans',sans-serif;font-size:.86rem;font-weight:700;cursor:pointer;transition:all .2s;text-decoration:none}
.qa-p{background:linear-gradient(135deg,#7c3aed,#ec4899);color:#fff;margin-bottom:.55rem}
.qa-p:hover{transform:translateY(-2px);box-shadow:0 8px 22px rgba(124,58,237,.32)}
.qa-s{background:#fff;border:1.5px solid rgba(0,0,0,.09);color:#374151}
[data-theme="dark"] .qa-s{background:rgba(255,255,255,.07);border-color:rgba(255,255,255,.13);color:#d1d5db}
.qa-s:hover{border-color:rgba(124,58,237,.4);color:#7c3aed}

/* THEME ROW */
.theme-row{background:#fff;border:1px solid rgba(0,0,0,.07);border-radius:13px;padding:.8rem 1rem;margin-bottom:.6rem;display:flex;align-items:center;justify-content:space-between}
[data-theme="dark"] .theme-row{background:rgba(255,255,255,.05);border-color:rgba(255,255,255,.09)}
.theme-lbl{font-size:.78rem;color:#9ca3af;font-weight:600}
.sw{position:relative;display:inline-block;width:42px;height:23px}
.sw input{opacity:0;width:0;height:0}
.sw-s{position:absolute;cursor:pointer;inset:0;background:rgba(0,0,0,.15);border-radius:99px;transition:.3s}
.sw-s::before{content:'';position:absolute;width:17px;height:17px;left:3px;top:3px;background:#fff;border-radius:50%;transition:.3s;box-shadow:0 1px 3px rgba(0,0,0,.2)}
.sw input:checked+.sw-s{background:linear-gradient(135deg,#7c3aed,#ec4899)}
.sw input:checked+.sw-s::before{transform:translateX(19px)}

/* SLIDE MENU */
.menu-ov{display:none;position:fixed;inset:0;background:rgba(0,0,0,.38);z-index:1000}
.menu-ov.on{display:block}
.menu-panel{position:fixed;top:0;right:-100%;width:230px;height:100vh;background:rgba(255,255,255,.97);backdrop-filter:blur(20px);border-left:1px solid rgba(0,0,0,.08);z-index:1001;transition:right .28s cubic-bezier(.16,1,.3,1);padding:1rem .9rem;display:flex;flex-direction:column}
[data-theme="dark"] .menu-panel{background:rgba(15,10,32,.97);border-color:rgba(255,255,255,.1)}
.menu-panel.on{right:0}
.menu-user{display:flex;align-items:center;gap:.6rem;padding:.6rem .7rem;border-radius:12px;background:rgba(124,58,237,.07);margin-bottom:.65rem;margin-top:2.8rem}
.menu-un{font-size:.84rem;font-weight:700}
.menu-role{font-size:.68rem;color:#7c3aed;font-weight:600}
.mi{display:flex;align-items:center;gap:.6rem;padding:.65rem .75rem;border-radius:10px;color:#374151;font-size:.84rem;font-weight:600;cursor:pointer;text-decoration:none;transition:all .2s;background:none;border:none;font-family:'Plus Jakarta Sans',sans-serif;width:100%;text-align:left}
[data-theme="dark"] .mi{color:#c4b5fd}
.mi:hover,.mi.act{background:rgba(124,58,237,.09);color:#7c3aed}
.mc{position:absolute;top:.9rem;right:.9rem;width:30px;height:30px;border-radius:8px;border:1px solid rgba(0,0,0,.09);background:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#6b7280;font-size:.8rem}
[data-theme="dark"] .mc{background:rgba(255,255,255,.1);border-color:rgba(255,255,255,.15)}

/* SPINNER */
.sp{width:28px;height:28px;border:3px solid rgba(124,58,237,.15);border-top-color:#7c3aed;border-radius:50%;animation:spin .7s linear infinite;margin:1.2rem auto}
@keyframes spin{to{transform:rotate(360deg)}}

/* EMPTY */
.emp{text-align:center;padding:1.25rem;color:#9ca3af;font-size:.8rem}

/* TOAST */
.toast{position:fixed;bottom:1.4rem;left:50%;transform:translateX(-50%);background:rgba(10,5,25,.88);color:#fff;padding:.7rem 1.2rem;border-radius:12px;font-size:.82rem;font-weight:600;z-index:9999;backdrop-filter:blur(12px);animation:fadeUp .3s ease both;white-space:nowrap}
@keyframes fadeUp{from{opacity:0;transform:translateX(-50%) translateY(10px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}

/* CODE MODAL */
.code-ov{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:2000;align-items:center;justify-content:center;padding:1rem}
.code-ov.on{display:flex}
.code-box{background:#fff;border-radius:20px;padding:1.5rem;width:100%;max-width:320px;box-shadow:0 20px 60px rgba(0,0,0,.25)}
[data-theme="dark"] .code-box{background:#1a0d30}
.ci{width:40px;height:46px;text-align:center;font-family:'Unbounded',sans-serif;font-weight:900;font-size:1.1rem;border:2px solid rgba(124,58,237,.25);border-radius:9px;background:rgba(124,58,237,.05);color:#1a1a2e;outline:none;transition:border-color .2s}
[data-theme="dark"] .ci{color:#e8e0ff;background:rgba(124,58,237,.1)}
.ci:focus{border-color:#7c3aed}

@keyframes fadeInUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.fin{animation:fadeInUp .4s ease both}
</style>
</head>
<body>

<!-- NAV -->
<nav class="nav">
  <div class="nav-logo" onclick="goTo('index.html')">TestPro</div>
  <div class="nav-r">
    <span class="nav-uname" id="nav-nm" style="display:none"></span>
    <div class="ava" id="nav-ava" onclick="goTo('profile.html')">?</div>
    <button class="icon-btn theme-toggle" title="Mavzu">üåô</button>
    <button class="icon-btn" id="hbtn">
      <div class="hamburger-icon"><span></span><span></span><span></span></div>
    </button>
  </div>
</nav>

<!-- MENU -->
<div class="menu-ov" id="mOv"></div>
<div class="menu-panel" id="mPanel">
  <button class="mc" id="mClose">‚úï</button>
  <div class="menu-user">
    <div class="ava" id="m-ava">?</div>
    <div><div class="menu-un" id="m-nm">...</div><div class="menu-role" id="m-role">Foydalanuvchi</div></div>
  </div>
  <a onclick="goTo('dashboard.html');return false" href="#" class="mi act">üìä Dashboard</a>
  <a onclick="goTo('create.html');return false" href="#" class="mi">‚úèÔ∏è Test yaratish</a>
  <a onclick="goTo('history.html');return false" href="#" class="mi">üìú Tarix</a>
  <a onclick="goTo('profile.html');return false" href="#" class="mi">üë§ Profil</a>
  <a onclick="goTo('index.html');return false" href="#" class="mi">üåê Bosh sahifa</a>
  <div id="admin-link"></div>
  <button id="logout-btn" class="mi" style="color:#ef4444;margin-top:auto">üö™ Chiqish</button>
</div>

<!-- PAGE -->
<div class="page">
 <div class="wrap">

  <!-- Greeting -->
  <div style="padding-top:.5rem;margin-bottom:.75rem" class="fin">
    <div style="font-family:'Unbounded',sans-serif;font-size:1.15rem;font-weight:900" id="greet">Salom! üëã</div>
    <div style="font-size:.75rem;color:#9ca3af;margin-top:.15rem">Bugun ham muvaffaqiyat tilayman</div>
  </div>

  <!-- Stats -->
  <div class="stats fin">
    <div class="st"><div class="st-v" id="s-t">0</div><div class="st-l">Testlarim</div></div>
    <div class="st"><div class="st-v" id="s-d">0</div><div class="st-l">Ishlangan</div></div>
    <div class="st"><div class="st-v" id="s-a">‚Äî</div><div class="st-l">O'rtacha</div></div>
  </div>

  <!-- My tests -->
  <div class="card fin">
    <div class="card-hdr">
      <div class="card-title">üìù Mening testlarim</div>
      <a onclick="goTo('create.html');return false" href="#" class="g-btn">+ Yangi test</a>
    </div>
    <div id="my-list"><div class="sp"></div></div>
  </div>

  <!-- Public tests -->
  <div class="card fin">
    <div class="card-hdr">
      <div class="card-title">üåê Ommaviy testlar</div>
      <div class="cnt-badge" id="pub-cnt">‚Äî</div>
    </div>
    <div id="pub-wrap"><div class="sp"></div></div>
  </div>

  <!-- Results -->
  <div class="card fin" id="res-card" style="display:none">
    <div class="card-hdr">
      <div class="card-title">üèÜ So'nggi natijalar</div>
      <a onclick="goTo('history.html');return false" href="#" style="font-size:.75rem;color:#7c3aed;font-weight:700">Barchasi ‚Üí</a>
    </div>
    <div id="res-list"></div>
  </div>

  <!-- Quick actions -->
  <div class="card fin">
    <div class="card-title" style="margin-bottom:.8rem">‚ö° Tezkor harakatlar</div>
    <a onclick="goTo('create.html');return false" href="#" class="qa qa-p">‚úèÔ∏è Yangi test yaratish</a>
    <button class="qa qa-s" onclick="openCodeModal()">üîë Kod orqali kirish</button>
  </div>

  <!-- Theme -->
  <div class="theme-row fin">
    <span class="theme-lbl">Interfeys rejimi</span>
    <label class="sw"><input type="checkbox" id="theme-sw" onchange="Theme.toggle()"/><span class="sw-s"></span></label>
  </div>

 </div>
</div>

<!-- Code modal -->
<div class="code-ov" id="code-ov">
  <div class="code-box">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem">
      <div style="font-weight:800;font-size:.98rem">üîë Kod kiritish</div>
      <button onclick="closeCodeModal()" style="background:none;border:none;cursor:pointer;font-size:1rem;color:#6b7280">‚úï</button>
    </div>
    <p style="font-size:.8rem;color:#6b7280;margin-bottom:.9rem">6 xonali ulashish kodini kiriting:</p>
    <div style="display:flex;gap:.35rem;justify-content:center;margin-bottom:.85rem" id="ci-wrap">
      <input class="ci" maxlength="1"/><input class="ci" maxlength="1"/><input class="ci" maxlength="1"/>
      <input class="ci" maxlength="1"/><input class="ci" maxlength="1"/><input class="ci" maxlength="1"/>
    </div>
    <div id="code-msg" style="min-height:18px;font-size:.78rem;text-align:center;margin-bottom:.75rem;font-weight:600"></div>
    <button onclick="enterCode()" style="width:100%;padding:.82rem;border-radius:11px;border:none;background:linear-gradient(135deg,#7c3aed,#ec4899);color:#fff;font-weight:700;font-size:.88rem;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif">Qidirish ‚Üí</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="js/firebase.js"></script>
<script src="js/theme.js"></script>
<script>
// Theme handled by theme.js

/* ‚îÄ‚îÄ Menu ‚îÄ‚îÄ */
const mPanel=document.getElementById('mPanel'), mOv=document.getElementById('mOv');
function openMenu(){ mPanel.classList.add('on'); mOv.classList.add('on'); }
function closeMenu(){ mPanel.classList.remove('on'); mOv.classList.remove('on'); }
document.getElementById('hbtn').onclick=openMenu;
document.getElementById('mClose').onclick=closeMenu;
mOv.onclick=closeMenu;

/* ‚îÄ‚îÄ Logout ‚îÄ‚îÄ */
document.getElementById('logout-btn').onclick=async()=>{
  await auth.signOut().catch(()=>{});
  goTo('login.html');
};

/* ‚îÄ‚îÄ Code modal ‚îÄ‚îÄ */
function openCodeModal(){ document.getElementById('code-ov').classList.add('on'); setTimeout(()=>document.querySelectorAll('.ci')[0]?.focus(),100); }
function closeCodeModal(){ document.getElementById('code-ov').classList.remove('on'); document.getElementById('code-msg').textContent=''; document.querySelectorAll('.ci').forEach(i=>i.value=''); }
window.openCodeModal=openCodeModal;
// code input auto-focus
document.querySelectorAll('.ci').forEach((inp,i,all)=>{
  inp.oninput=()=>{ inp.value=inp.value.toUpperCase().slice(-1); if(inp.value&&all[i+1]) all[i+1].focus(); };
  inp.onkeydown=e=>{ if(e.key==='Backspace'&&!inp.value&&all[i-1]) all[i-1].focus(); };
});

/* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
function toast(msg){ const t=docume
